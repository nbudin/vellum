<h1>Members for <%=h @project.name %></h1>

<div class="jumpbox">
  <div class="navigation">
    <% link_to project_path(@project), :class => "button back" do %>
      <%= image_tag "arrow_left.png" %>
      Back to <%=h @project.name %>
    <% end -%>
  </div>
</div>

<style type="text/css">
#members {
  border-collapse: collapse;
  max-width: 50em;
  width: 100%;
}

#members th {
  background-color: #000;
  color: #fff;
  text-align: left;
}

#members tr.odd {
  background-color: #eee;
}

#members tr.even {
  background-color: #ddd;
}
</style>

<% if @project.errors.count > 0 -%>
  <h2>Sorry!  There were some errors saving your changes:</h2>
  
  <ul>
    <% @project.errors.full_messages.each do |msg| -%>
      <li><%=h msg%></li>
    <% end -%>
  </ul>
<% end -%>

<% form_for @project do |f| %>

  <p>Only the people listed in the table below will be able to see this project and its contents.  Authors can edit the 
  documents and templates in the project, and admins can delete the project and change its members.</p>

  <table id="members">
    <tr>
      <th></th>
      <th>Email address</th>
      <th>Author?</th>
      <th>Admin?</th>
      <th></th>
    </tr>
    <% f.fields_for :project_memberships do |membership_fields| -%>
      <tr class="<%= cycle "odd", "even" %>">
        <% if membership_fields.object.new_record? -%>
          <td style="text-align: right;"><%= membership_fields.label :email, "Add:" %></td>
          <td><%= membership_fields.text_field :email %></td>
        <% else -%>
          <td></td>
          <td><%= membership_fields.object.person.email %></td>
        <% end -%>
        
        <% if membership_fields.object.person == current_person -%>
          <td><%= membership_fields.check_box :author, :disabled => true %></td>
          <td><%= membership_fields.check_box :admin, :disabled => true %></td>
          <td></td>
        <% else -%>
          <td><%= membership_fields.check_box :author %></td>
          <td><%= membership_fields.check_box :admin %></td>
          <td style="text-align: right;">
            <% unless membership_fields.object.new_record? -%>
              <%= membership_fields.label :_destroy, "Remove?" %> <%= membership_fields.check_box :_destroy %>
            <% end -%>
          </td>
        <% end -%>
      </tr>
    <% end -%>
    <tr>
      <td style="text-align: right;" colspan="5">
        <%= f.submit %>
      </td>
    </tr>
  </table>
<% end -%>